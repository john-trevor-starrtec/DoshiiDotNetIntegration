<?xml version="1.0"?>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title></title>
</head>
<body>
<div class="wsd" wsd_style="modern-blue">
<pre>

title Initialize

participant POS
participant DoshiiHttp
participant DoshiiSockets

POS->DoshiiSockets: Initialize socket connection with \n wss://prealpha.doshii.co/pos/api/v1/socket?token=&lt;your venue token&gt;
DoshiiSockets->POS: Successfull connection

note right of POS
The web sockets connection was initialized successfully
Now send setting data via http 
end note 

POS->DoshiiHttp: PUT ../config 
alt failed
	DoshiiHttp->POS: Failed
	POS->POS: close socket connection
else successful
	DoshiiHttp->POS: Successful
	alt Only if Bistro mode 
		POS->DoshiiHttp: Request payment for all open checkins. \n PUT ../orders/:id \n order status = waiting for payment
		DoshiiHttp->POS: Response from payment request
	end
	POS->DoshiiHttp: Get all checked in consumers from Doshii. \n GET ../consumers
	DoshiiHttp: Returns consumer data
	POS->POS: check if consumer is currently checked into POS
	alt Consumer not currently checked into pos/api/v1/socket
		POS->DoshiiHttp: Get consumer data from Doshii. \n GET <consumer uri>
		POS->POS: process consumer checkin event.
	end
	POS->DoshiiHttp: Get current active table allocations. \n GET ../tables
	DoshiiHttp: returns current table allocations
	POS->POS: Process table allocations. 
	POS->POS: Remove consumers that are checked into the POS but are not currently checked into Doshii
	POS->DoshiiHttp: Get all current orders from Doshii. \n GET ../orders
	DoshiiHttp->POS: Returns orderId, uri, and status
	alt Order status is 'pending', 'ready to pay', or cancelled 
		POS->DoshiiHttp: get order to process. \n GET ../orders/:id 
		DoshiiHttp->POS: returns order
		POS->POS: process order
	end 
	
end

</pre>
</div>
<script type="text/javascript" src="http://www.websequencediagrams.com/service.js"></script>
</body>
</html>
